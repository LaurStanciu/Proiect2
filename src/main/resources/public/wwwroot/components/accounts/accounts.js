!function(){"use strict";function t(t,n,e,r,o,s,a,i){r.accounts=t,r.data=n,r.vm={signIn:{},signUp:{}},r.responses={signIn:{},signUp:{}},r.contents={current:{},edit:{}},r.events={redirect:function(){t.loadIdentity().then(function(){var t=e.search().returnState,n=e.search().returnStateParams;t&&"^"!==t&&"sign-in"!==t&&"sign-up"!==t&&"sign-out"!==t?(n=JSON.parse(decodeURIComponent(n)),o.go(t,n,{reload:!0})):o.go("app.default")})},signIn:function(){r.progressbar&&r.progressbar.complete(),r.progressbar=a.createInstance(),r.progressbar.start(),r.responses.signIn={},t.signIn(r.vm.signIn).then(function(t){r.progressbar.complete(),1==t.data.type&&r.events.redirect(),r.responses.signIn=t.data})},signUp:function(){r.progressbar&&r.progressbar.complete(),r.progressbar=a.createInstance(),r.progressbar.start(),r.responses.signUp={},t.signUp(r.vm.signUp).then(function(t){r.progressbar.complete(),1==t.data.type&&r.events.redirect(),r.responses.signUp=t.data})},getContents:function(){s.account_Id&&s.role&&(r.progressbar&&r.progressbar.complete(),r.progressbar=a.createInstance(),r.progressbar.start(),t.getContents({id:s.account_Id},{role:s.role}).then(function(t){r.progressbar.complete(),200==t.status&&(r.contents.current=t.data,o.includes("account.profile")&&(r.contents.edit=$.extend(!0,{},r.contents.current)))}))},updateContents:function(n){if(s.account_Id&&s.role){r.progressbar&&r.progressbar.complete(),r.progressbar=a.createInstance(),r.progressbar.start();var e=0==(r.profile.edit.account_Id||0)?s.account_Id:r.profile.edit.account_Id,o=null==(r.profile.edit.role||null)?s.role:r.profile.edit.role,u={account_Id:e,role:o,about:null,workingHours:null};"about"==n&&(u.about=r.contents.edit.about),"workingHours"==n&&(u.workingHours=r.contents.edit.workingHours),t.updateContents(u).then(function(e){r.progressbar.complete();var o={data:{type:3,status:e.status,texts:[]}},a={};if(401==e.status&&t.loadIdentity(),200==e.status){1==e.data.type?("about"==n&&(r.responses.contents.about.data=e.data,r.contents.current.about=$.extend(!0,{},r.contents.edit.about)),"workingHours"==n&&(r.responses.contents.workingHours.data=e.data,r.contents.current.workingHours=$.extend(!0,{},r.contents.edit.workingHours)),a=toastSuccess()):a=toastWarning();for(var u=0;u<e.data.texts.length;u++)a.content+="<span>"+e.data.texts[u]+"</span>"}else"about"==n&&(r.responses.contents.about=o),"workingHours"==n&&(r.responses.contents.workingHours=o),a=toastFailed();i.create({className:a.className,content:a.content}),t.identity().Id==s.account_Id&&(r.editable=!0)})}}}}angular.module("app").controller("accountsCtrl",t),t.$inject=["accounts","data","$location","$scope","$state","$stateParams","ngProgressBar","ngToast"]}(),function(){"use strict";function t(t,n,e,r){var o={identity:{},contents:null},s={identity:function(){var e=n.location.newURL(!0,{api:"api",controller:"accounts",action:"identity"});return t.post(e).then(function(t){return t},function(t){return t})},signOut:function(){var e=n.location.newURL(!0,{api:"api",controller:"accounts",action:"signOut"});return t.post(e).then(function(t){return t},function(t){return t})},signUp:function(e){var r=n.location.newURL(!0,{api:"api",controller:"accounts",action:"signUp"});return t.post(r,e).then(function(t){return t},function(t){return t})},signIn:function(e){var r=n.location.newURL(!0,{api:"api",controller:"accounts",action:"signIn"});return t.post(r,e).then(function(t){return t},function(t){return t})},getContents:function(e,r){var o=$.extend({},{id:0},e),s=$.extend({},{role:null,country:null,language:null},r),a=n.location.newURL(!0,{api:"api",controller:"accounts",id:o.id,segments:["contents"]},s);return t.get(a).then(function(t){return t},function(t){return t})},updateContents:function(e,r,o){var s=$.extend({},{id:0},e),a=$.extend({},{role:null,country:null,language:null},r),i=n.location.newURL(!0,{api:"api",controller:"accounts",id:s.id,segments:["contents"]},a);return t.post(i,o).then(function(t){return t},function(t){return t})}},a={};return a.identity=function(){return o.identity},a.loadIdentity=function(){return s.identity().then(function(t){return 200==t.status&&(o.identity=$.extend(!0,{},t.data)),t})},a.isAuthenticated=function(){return 0!=o.identity.Id&&null!=o.identity.Id},a.signIn=function(t){return s.signOut().then(function(n){return o.identity={},s.signIn(t)}).then(function(t){return t})},a.signUp=function(t){return s.signOut().then(function(n){return s.signUp(t)}).then(function(t){return t})},a.signOut=function(){return s.signOut().then(function(t){return o.identity={},t}).then(function(){setTimeout(function(){window.location.reload(!1)},100)})},a.sref=function(t){var n=$.extend(!0,{},{state:"sign-in"},t),o=e.search().returnState,s=e.search().returnStateParams;o=o?o:encodeURIComponent(r.current.name),s=s?s:encodeURIComponent(JSON.stringify(r.params)),r.go(n.state,{returnState:o,returnStateParams:s},{reload:!0,notify:!0})},a.getContents=function(t,n){return s.getContents(t,n).then(function(t){return t})},a.updateContents=function(t,n,e){return s.updateContents(t,n,e).then(function(t){return t})},a.load=function(t){if(t||null==o.identity.Id)return a.loadIdentity()},a}angular.module("app").factory("accounts",t),t.$inject=["$http","data","$location","$state"]}();